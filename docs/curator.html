<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Performance DSP Intelligence</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
:root{--bg:#08080e;--s1:#10101a;--s2:#161622;--s3:#1c1c2e;--bd:#252538;--t1:#e8e8f4;--t2:#9898b0;--t3:#606078;--ac:#6366f1;--ac2:#818cf8;--gr:#10b981;--rd:#ef4444;--yl:#f59e0b;--bl:#3b82f6;--pp:#8b5cf6;--pk:#ec4899;--r:10px;--rs:6px;--tr:.2s}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--t1);font-size:14px;line-height:1.5}
a{color:var(--ac2);text-decoration:none}a:hover{text-decoration:underline}

/* Layout */
.shell{display:grid;grid-template-columns:240px 1fr;min-height:100vh}
.sidebar{background:var(--s1);border-right:1px solid var(--bd);padding:20px 16px;position:sticky;top:0;height:100vh;overflow-y:auto}
.main{padding:24px 28px;max-width:1400px}

/* Sidebar */
.sb-logo{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:var(--ac2);margin-bottom:4px}
.sb-sub{font-size:11px;color:var(--t3);margin-bottom:20px}
.sb-section{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--t3);margin:18px 0 8px}
.sb-link{display:block;padding:7px 12px;border-radius:var(--rs);font-size:13px;color:var(--t2);cursor:pointer;transition:var(--tr)}
.sb-link:hover,.sb-link.active{background:var(--s2);color:var(--t1);text-decoration:none}
.sb-link .cnt{float:right;font-size:11px;background:var(--s3);padding:1px 6px;border-radius:10px;color:var(--t3)}

/* Search */
.search-box{width:100%;padding:8px 12px;background:var(--s2);border:1px solid var(--bd);border-radius:var(--rs);color:var(--t1);font-size:13px;margin-bottom:12px;outline:none}
.search-box:focus{border-color:var(--ac)}
.sb-filters label{display:flex;align-items:center;gap:6px;padding:3px 0;font-size:12px;color:var(--t2);cursor:pointer}
.sb-filters input[type="checkbox"]{accent-color:var(--ac);width:14px;height:14px}

/* Header */
.hdr{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:24px;border-bottom:2px solid var(--ac);padding-bottom:16px}
.hdr h1{font-size:24px;font-weight:800;letter-spacing:-0.5px}
.hdr h1 span{color:var(--ac2)}
.hdr-meta{font-size:11px;color:var(--t3);text-align:right}
.hdr-tags{display:flex;gap:6px;margin-top:6px;flex-wrap:wrap}
.hdr-tag{font-size:9px;font-weight:600;text-transform:uppercase;letter-spacing:1px;padding:2px 8px;border-radius:3px;border:1px solid var(--bd);color:var(--t3)}
.hdr-tag.hl{border-color:var(--ac);color:var(--ac2)}

/* Tiles */
.tiles{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin-bottom:24px}
.tile{background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);padding:16px;text-align:center}
.tile-val{font-size:28px;font-weight:800;color:var(--ac2)}
.tile-label{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--t3);margin-top:2px}

/* Panels */
.panel{background:var(--s1);border:1px solid var(--bd);border-radius:var(--r);padding:20px;margin-bottom:20px}
.panel-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.panel-hdr h2{font-size:16px;font-weight:700}
.panel-hdr .pill{font-size:10px;background:var(--ac);color:white;padding:2px 8px;border-radius:10px}

/* Grid layouts */
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.three-col{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px}

/* Signal cards */
.signal-card{background:var(--s2);border:1px solid var(--bd);border-left:4px solid var(--ac);border-radius:var(--r);padding:16px;margin-bottom:10px;transition:var(--tr)}
.signal-card:hover{border-color:var(--ac);transform:translateX(3px)}
.signal-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.signal-badge{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;padding:2px 8px;border-radius:3px}
.signal-score{font-size:12px;font-weight:700;padding:2px 8px;border-radius:10px}
.score-high{background:rgba(16,185,129,.15);color:var(--gr)}
.score-med{background:rgba(245,158,11,.15);color:var(--yl)}
.score-low{background:rgba(239,68,68,.15);color:var(--rd)}
.signal-title{font-size:14px;font-weight:600;margin-bottom:4px}
.signal-title a{color:var(--t1)}
.signal-title a:hover{color:var(--ac2)}
.signal-meta{font-size:11px;color:var(--t3);margin-bottom:6px;display:flex;gap:12px}
.signal-why{font-size:12px;color:var(--t2);line-height:1.5;margin-bottom:4px}
.signal-action{font-size:12px;color:var(--gr);font-weight:500}
.signal-entities{display:flex;gap:4px;margin-top:6px;flex-wrap:wrap}
.entity-chip{font-size:10px;padding:1px 6px;border-radius:3px;background:rgba(99,102,241,.1);color:var(--ac2);border:1px solid rgba(99,102,241,.2)}
.conf-badge{font-size:9px;padding:1px 6px;border-radius:3px;margin-left:6px}
.conf-high{background:rgba(16,185,129,.1);color:var(--gr)}
.conf-med{background:rgba(245,158,11,.1);color:var(--yl)}
.conf-low{background:rgba(239,68,68,.1);color:var(--rd)}

/* Watchlist */
.watch-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--bd)}
.watch-row:last-child{border:none}
.watch-name{font-weight:600;font-size:14px}
.watch-count{font-size:12px;color:var(--t3)}
.watch-signal{font-size:11px;color:var(--t2);max-width:60%;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* Learning row */
.learn-row{display:flex;gap:12px;align-items:flex-start;padding:10px 14px;background:var(--s2);border:1px solid var(--bd);border-radius:var(--rs);margin-bottom:6px;transition:var(--tr)}
.learn-row:hover{border-color:var(--yl);transform:translateX(3px)}
.learn-num{font-size:12px;font-weight:800;color:var(--yl);background:rgba(245,158,11,.1);padding:3px 8px;border-radius:5px;flex-shrink:0}
.learn-body{flex:1;font-size:13px}
.learn-body a{color:var(--ac2);font-weight:600}
.learn-badge{font-size:9px;font-weight:600;padding:1px 6px;border-radius:3px;margin-left:6px}

/* Charts */
.chart-container{position:relative;height:260px}

/* Spotify badge */
.spotify{display:inline-flex;align-items:center;gap:3px;font-size:9px;font-weight:600;color:#1DB954;background:rgba(29,185,84,.1);padding:2px 6px;border-radius:3px}

/* Content list (filterable) */
.content-item{display:flex;gap:14px;padding:14px;background:var(--s2);border:1px solid var(--bd);border-radius:var(--r);margin-bottom:8px;transition:var(--tr)}
.content-item:hover{border-color:var(--ac)}
.content-item.noise{opacity:0.4;display:none}
.show-noise .content-item.noise{display:flex}
.ci-score{flex-shrink:0;width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:800;border:2px solid}
.ci-score.high{border-color:var(--gr);color:var(--gr)}
.ci-score.med{border-color:var(--yl);color:var(--yl)}
.ci-score.low{border-color:var(--rd);color:var(--rd)}
.ci-body{flex:1;min-width:0}
.ci-title{font-size:14px;font-weight:600;margin-bottom:2px}
.ci-title a{color:var(--t1)}.ci-title a:hover{color:var(--ac2)}
.ci-meta{font-size:11px;color:var(--t3);display:flex;gap:10px;flex-wrap:wrap;margin-bottom:4px}
.ci-summary{font-size:12px;color:var(--t2);margin-bottom:4px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.ci-insights{font-size:11px;display:grid;grid-template-columns:1fr 1fr;gap:4px}
.ci-why{color:var(--t2)}.ci-act{color:var(--gr)}
.ci-tags{display:flex;gap:4px;margin-top:4px;flex-wrap:wrap}

/* Responsive */
@media(max-width:1100px){.two-col,.three-col{grid-template-columns:1fr}}
@media(max-width:800px){.shell{grid-template-columns:1fr}.sidebar{display:none}}
</style>
</head>
<body>
<div class="shell">
<aside class="sidebar">
    <div class="sb-logo">DSP Intelligence</div>
    <div class="sb-sub">Performance DSP & Exchange</div>
    <input type="text" class="search-box" id="search" placeholder="Search titles, entities...">
    <div class="sb-section">Sections</div>
    <a class="sb-link active" data-section="all" href="#">All</a>
    <a class="sb-link" data-section="signals" href="#">Key Signals <span class="cnt" id="cnt-signals">0</span></a>
    <a class="sb-link" data-section="learnings" href="#">Key Learnings <span class="cnt" id="cnt-learnings">0</span></a>
    <a class="sb-link" data-section="mustreads" href="#">Must-Read <span class="cnt" id="cnt-mustreads">0</span></a>
    <a class="sb-link" data-section="watchlist" href="#">Watchlist</a>
    <a class="sb-link" data-section="allitems" href="#">All Items <span class="cnt" id="cnt-items">0</span></a>
    <div class="sb-section">Filters</div>
    <div class="sb-filters" id="topic-filters"></div>
    <div class="sb-section">Source Type</div>
    <div class="sb-filters" id="type-filters"></div>
    <div class="sb-section">Display</div>
    <div class="sb-filters">
        <label><input type="checkbox" id="show-noise"> Show noise items</label>
    </div>
</aside>
<div class="main">
    <div class="hdr">
        <div>
            <h1>Performance DSP <span>Intelligence</span></h1>
            <div class="hdr-tags">
                <span class="hdr-tag hl">DAILY INTEL</span>
                <span class="hdr-tag">SCORED</span>
                <span class="hdr-tag">DEDUPLICATED</span>
                <span class="hdr-tag">CLASSIFIED</span>
            </div>
        </div>
        <div class="hdr-meta">
            <div id="gen-time"></div>
            <div id="source-count"></div>
        </div>
    </div>

    <!-- Tiles -->
    <div class="tiles" id="tiles"></div>

    <!-- Key Signals -->
    <div class="panel section-panel" data-panel="signals">
        <div class="panel-hdr"><h2>Today's Key Signals</h2><span class="pill" id="pill-signals">0</span></div>
        <div id="signals-container"></div>
    </div>

    <!-- Charts + Watchlist row -->
    <div class="two-col">
        <div class="panel">
            <div class="panel-hdr"><h2>Topic Momentum</h2><span class="pill">Weighted</span></div>
            <div class="chart-container"><canvas id="chart-topics"></canvas></div>
        </div>
        <div class="panel section-panel" data-panel="watchlist">
            <div class="panel-hdr"><h2>Watchlist</h2><span class="pill">Companies</span></div>
            <div id="watchlist-container"></div>
        </div>
    </div>

    <!-- Key Learnings -->
    <div class="panel section-panel" data-panel="learnings">
        <div class="panel-hdr"><h2>Key Learnings</h2><span class="pill" id="pill-learnings">0</span></div>
        <div id="learnings-container"></div>
    </div>

    <!-- Must-Reads -->
    <div class="panel section-panel" data-panel="mustreads">
        <div class="panel-hdr"><h2>Must-Read / Must-Listen</h2><span class="pill" id="pill-mustreads">0</span></div>
        <div id="mustreads-container"></div>
    </div>

    <!-- Source distribution -->
    <div class="panel">
        <div class="panel-hdr"><h2>Source Distribution</h2></div>
        <div class="chart-container"><canvas id="chart-sources"></canvas></div>
    </div>

    <!-- All Items -->
    <div class="panel section-panel" data-panel="allitems">
        <div class="panel-hdr"><h2>All Items</h2><span class="pill" id="pill-items">0</span></div>
        <div id="items-container"></div>
    </div>

    <footer style="text-align:center;padding:32px;color:var(--t3);font-size:11px">
        Ad Tech Intelligence &middot; Deterministic scoring &middot; No AI calls &middot; Static site
    </footer>
</div>
</div>

<script>
const COLORS={Policy:'#8b5cf6','Market Structure':'#3b82f6',Product:'#10b981',Earnings:'#f59e0b',Measurement:'#ec4899',Fraud:'#ef4444',Creative:'#14b8a6',default:'#6b7280'};
const CHART_COLORS=['#6366f1','#3b82f6','#10b981','#f59e0b','#ef4444','#8b5cf6','#ec4899','#14b8a6','#f97316','#06b6d4','#84cc16','#a855f7'];
Chart.defaults.color='#606078';Chart.defaults.borderColor='#252538';

let ITEMS=[],SUMMARY={},activeTopics=new Set(),activeTypes=new Set();

async function init(){
    try{
        const[itemsR,summaryR]=await Promise.all([fetch('data/items.json'),fetch('data/daily_summary.json')]);
        ITEMS=await itemsR.json();SUMMARY=await summaryR.json();
    }catch(e){console.error('Failed to load data',e);return;}
    render();
}

function scoreClass(s){return s>=55?'high':s>=25?'med':'low'}
function badgeColor(type){return COLORS[type]||COLORS.default}
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}
function fmtDate(iso){if(!iso)return'';try{const d=new Date(iso);return d.toLocaleDateString('en-US',{month:'short',day:'numeric'})}catch(e){return''}}

function render(){
    const t=SUMMARY.tiles||{};
    document.getElementById('gen-time').textContent='Generated '+fmtDate(SUMMARY.generated_at);
    document.getElementById('source-count').textContent=t.sources_active+' sources active';

    // Tiles
    const tilesEl=document.getElementById('tiles');
    tilesEl.innerHTML=[
        {v:t.active_items,l:'Items Analyzed'},
        {v:t.avg_priority,l:'Avg Priority'},
        {v:t.high_priority,l:'Key Signals'},
        {v:t.noise_filtered,l:'Noise Filtered'},
        {v:t.duplicates_removed,l:'Deduped'},
        {v:t.sources_active,l:'Sources'},
    ].map(d=>`<div class="tile"><div class="tile-val">${d.v}</div><div class="tile-label">${d.l}</div></div>`).join('');

    document.getElementById('cnt-signals').textContent=(SUMMARY.key_signals||[]).length;
    document.getElementById('cnt-learnings').textContent=(SUMMARY.key_learnings||[]).length;
    document.getElementById('cnt-mustreads').textContent=(SUMMARY.must_reads||[]).length;
    document.getElementById('cnt-items').textContent=ITEMS.filter(i=>!i.is_noise).length;
    document.getElementById('pill-signals').textContent=(SUMMARY.key_signals||[]).length;
    document.getElementById('pill-learnings').textContent=(SUMMARY.key_learnings||[]).length;
    document.getElementById('pill-mustreads').textContent=(SUMMARY.must_reads||[]).length;
    document.getElementById('pill-items').textContent=ITEMS.length;

    renderSignals();renderLearnings();renderMustReads();renderWatchlist();renderAllItems();
    renderTopicChart();renderSourceChart();buildFilters();bindEvents();
}

function renderSignals(){
    const el=document.getElementById('signals-container');
    el.innerHTML=(SUMMARY.key_signals||[]).map(s=>{
        const sc=scoreClass(s.priority_score);
        const bc=badgeColor(s.signal_type);
        const entities=(s.entities||[]).map(e=>`<span class="entity-chip">${esc(e.name)}</span>`).join('');
        const conf=s.confidence||'medium';
        return`<div class="signal-card">
            <div class="signal-top">
                <div><span class="signal-badge" style="background:${bc}20;color:${bc}">${esc(s.signal_type||'Signal')}</span>
                <span class="conf-badge conf-${conf}">${conf}</span></div>
                <span class="signal-score ${sc}">${s.priority_score}</span>
            </div>
            <div class="signal-title"><a href="${esc(s.url)}" target="_blank">${esc(s.title)}</a></div>
            <div class="signal-meta"><span>${esc(s.source)}</span><span>${fmtDate(s.published_at)}</span><span>${esc(s.source_type||'')}</span></div>
            <div class="signal-why"><strong>Why:</strong> ${esc(s.why_it_matters||'')}</div>
            <div class="signal-action"><strong>Do:</strong> ${esc(s.recommended_action||'')}</div>
            ${entities?'<div class="signal-entities">'+entities+'</div>':''}
        </div>`}).join('');
}

function renderLearnings(){
    const el=document.getElementById('learnings-container');
    el.innerHTML=(SUMMARY.key_learnings||[]).map((l,i)=>{
        const bc=badgeColor(l.signal_type);
        return`<div class="learn-row">
            <span class="learn-num">${String(i+1).padStart(2,'0')}</span>
            <div class="learn-body">
                <a href="${esc(l.url)}" target="_blank">${esc(l.title)}</a>
                <span class="learn-badge" style="background:${bc}20;color:${bc}">${esc(l.signal_type||'General')}</span>
                <div style="color:var(--t2);font-size:11px;margin-top:2px">${esc(l.source)} &middot; ${esc(l.why_it_matters||'').substring(0,120)}</div>
            </div>
        </div>`}).join('');
}

function renderMustReads(){
    const el=document.getElementById('mustreads-container');
    el.innerHTML=(SUMMARY.must_reads||[]).map(s=>{
        const sc=scoreClass(s.priority_score);
        const spotify=s.spotify_url?`<span class="spotify"><svg width="12" height="12" viewBox="0 0 24 24" fill="#1DB954"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg> Spotify</span>`:'';
        const entities=(s.entities||[]).map(e=>`<span class="entity-chip">${esc(e.name)}</span>`).join('');
        return`<div class="signal-card">
            <div class="signal-top">
                <div><span class="signal-badge" style="background:${badgeColor(s.signal_type)}20;color:${badgeColor(s.signal_type)}">${esc(s.signal_type||s.source_type||'')}</span>${spotify}</div>
                <span class="signal-score ${sc}">${s.priority_score}</span>
            </div>
            <div class="signal-title"><a href="${esc(s.url)}" target="_blank">${esc(s.title)}</a></div>
            <div class="signal-meta"><span>${esc(s.source)}</span><span>${fmtDate(s.published_at)}</span></div>
            <div class="signal-why"><strong>Why:</strong> ${esc(s.why_it_matters||'')}</div>
            <div class="signal-action"><strong>Do:</strong> ${esc(s.recommended_action||'')}</div>
            ${entities?'<div class="signal-entities">'+entities+'</div>':''}
        </div>`}).join('');
}

function renderWatchlist(){
    const el=document.getElementById('watchlist-container');
    const wl=SUMMARY.watchlist||{};
    el.innerHTML=Object.entries(wl).map(([name,data])=>{
        const sig=data.top_signal;
        return`<div class="watch-row">
            <div><div class="watch-name">${esc(name)}</div><div class="watch-count">${data.count} mention${data.count!==1?'s':''}</div></div>
            <div class="watch-signal">${sig?`<a href="${esc(sig.url)}" target="_blank">${esc(sig.title.substring(0,50))}</a>`:''}</div>
        </div>`}).join('')||'<div style="color:var(--t3);padding:20px;text-align:center">No entity mentions this period</div>';
}

function renderAllItems(){
    const el=document.getElementById('items-container');
    el.innerHTML=ITEMS.map(item=>{
        const sc=scoreClass(item.priority_score);
        const noiseClass=item.is_noise?'noise':'';
        const topics=(item.topics||[]).map(t=>`<span class="signal-badge" style="background:${badgeColor(t.signal_type)}20;color:${badgeColor(t.signal_type)};font-size:9px">${esc(t.label)}</span>`).join('');
        const entities=(item.entities||[]).map(e=>`<span class="entity-chip">${esc(e.name)}</span>`).join('');
        const spotify=item.spotify_url?`<span class="spotify"><svg width="10" height="10" viewBox="0 0 24 24" fill="#1DB954"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg></span>`:'';
        return`<div class="content-item ${noiseClass}" data-topics="${(item.topics||[]).map(t=>t.key).join(',')}" data-type="${item.type}" data-score="${item.priority_score}">
            <div class="ci-score ${sc}">${item.priority_score}</div>
            <div class="ci-body">
                <div class="ci-title"><a href="${esc(item.url)}" target="_blank">${esc(item.title)}</a> ${spotify}</div>
                <div class="ci-meta"><span>${esc(item.source)}</span><span>${fmtDate(item.published_at)}</span><span>${esc(item.type)}</span><span class="conf-badge conf-${item.confidence||'med'}">${item.confidence||'medium'}</span></div>
                <div class="ci-summary">${esc(item.summary||'')}</div>
                <div class="ci-insights">
                    <div class="ci-why"><strong>Why:</strong> ${esc((item.why_it_matters||'').substring(0,150))}</div>
                    <div class="ci-act"><strong>Do:</strong> ${esc((item.recommended_action||'').substring(0,120))}</div>
                </div>
                <div class="ci-tags">${topics}${entities}</div>
            </div>
        </div>`}).join('');
}

function renderTopicChart(){
    const data=SUMMARY.topic_momentum||[];
    if(!data.length)return;
    new Chart(document.getElementById('chart-topics'),{
        type:'bar',
        data:{labels:data.map(d=>d.label),datasets:[{label:'Momentum Score',data:data.map(d=>d.score),backgroundColor:data.map((_,i)=>CHART_COLORS[i%CHART_COLORS.length]),borderRadius:6}]},
        options:{indexAxis:'y',plugins:{legend:{display:false}},scales:{x:{grid:{display:false}}}}
    });
}

function renderSourceChart(){
    const data=(SUMMARY.source_distribution||[]).slice(0,12);
    if(!data.length)return;
    new Chart(document.getElementById('chart-sources'),{
        type:'doughnut',
        data:{labels:data.map(d=>d.name),datasets:[{data:data.map(d=>d.count),backgroundColor:CHART_COLORS.slice(0,data.length),borderWidth:0}]},
        options:{plugins:{legend:{position:'right',labels:{boxWidth:10,padding:8,font:{size:11}}}}}
    });
}

function buildFilters(){
    // Topic filters
    const topicSet=new Set();
    ITEMS.forEach(i=>(i.topics||[]).forEach(t=>{topicSet.add(t.key+'|'+t.label)}));
    const tf=document.getElementById('topic-filters');
    tf.innerHTML=[...topicSet].sort().map(t=>{
        const[key,label]=t.split('|');
        return`<label><input type="checkbox" checked data-topic="${key}"> ${label}</label>`}).join('');

    // Type filters
    const types=new Set(ITEMS.map(i=>i.type));
    const tyf=document.getElementById('type-filters');
    tyf.innerHTML=[...types].sort().map(t=>`<label><input type="checkbox" checked data-type="${t}"> ${t}</label>`).join('');
}

function bindEvents(){
    // Search
    document.getElementById('search').addEventListener('input',e=>{
        const q=e.target.value.toLowerCase();
        document.querySelectorAll('.content-item').forEach(el=>{
            const text=el.textContent.toLowerCase();
            el.style.display=(!q||text.includes(q))?'flex':'none';
        });
    });

    // Noise toggle
    document.getElementById('show-noise').addEventListener('change',e=>{
        document.querySelector('.main').classList.toggle('show-noise',e.target.checked);
    });

    // Topic filters
    document.getElementById('topic-filters').addEventListener('change',filterItems);
    document.getElementById('type-filters').addEventListener('change',filterItems);

    // Section nav
    document.querySelectorAll('.sb-link[data-section]').forEach(link=>{
        link.addEventListener('click',e=>{
            e.preventDefault();
            document.querySelectorAll('.sb-link').forEach(l=>l.classList.remove('active'));
            link.classList.add('active');
            const sec=link.dataset.section;
            if(sec==='all'){
                document.querySelectorAll('.section-panel,.panel,.two-col,.tiles').forEach(p=>p.style.display='');
            }else{
                document.querySelectorAll('.section-panel,.two-col,.tiles').forEach(p=>p.style.display='none');
                document.querySelector('.tiles').style.display='';
                const target=document.querySelector(`.section-panel[data-panel="${sec}"]`);
                if(target)target.style.display='';
            }
        });
    });
}

function filterItems(){
    const checkedTopics=new Set([...document.querySelectorAll('#topic-filters input:checked')].map(i=>i.dataset.topic));
    const checkedTypes=new Set([...document.querySelectorAll('#type-filters input:checked')].map(i=>i.dataset.type));
    document.querySelectorAll('.content-item').forEach(el=>{
        const topics=(el.dataset.topics||'').split(',').filter(Boolean);
        const type=el.dataset.type;
        const topicMatch=topics.length===0||topics.some(t=>checkedTopics.has(t));
        const typeMatch=checkedTypes.has(type);
        el.style.display=(topicMatch&&typeMatch)?'flex':'none';
    });
}

init();
</script>
</body>
</html>
